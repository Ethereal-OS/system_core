{"payload":{"allShortcutsEnabled":false,"fileTree":{"fs_mgr/libsnapshot/snapuserd/user-space-merge":{"items":[{"name":"snapuserd_core.cpp","path":"fs_mgr/libsnapshot/snapuserd/user-space-merge/snapuserd_core.cpp","contentType":"file"},{"name":"snapuserd_core.h","path":"fs_mgr/libsnapshot/snapuserd/user-space-merge/snapuserd_core.h","contentType":"file"},{"name":"snapuserd_dm_user.cpp","path":"fs_mgr/libsnapshot/snapuserd/user-space-merge/snapuserd_dm_user.cpp","contentType":"file"},{"name":"snapuserd_merge.cpp","path":"fs_mgr/libsnapshot/snapuserd/user-space-merge/snapuserd_merge.cpp","contentType":"file"},{"name":"snapuserd_readahead.cpp","path":"fs_mgr/libsnapshot/snapuserd/user-space-merge/snapuserd_readahead.cpp","contentType":"file"},{"name":"snapuserd_server.cpp","path":"fs_mgr/libsnapshot/snapuserd/user-space-merge/snapuserd_server.cpp","contentType":"file"},{"name":"snapuserd_server.h","path":"fs_mgr/libsnapshot/snapuserd/user-space-merge/snapuserd_server.h","contentType":"file"},{"name":"snapuserd_test.cpp","path":"fs_mgr/libsnapshot/snapuserd/user-space-merge/snapuserd_test.cpp","contentType":"file"},{"name":"snapuserd_transitions.cpp","path":"fs_mgr/libsnapshot/snapuserd/user-space-merge/snapuserd_transitions.cpp","contentType":"file"},{"name":"snapuserd_verify.cpp","path":"fs_mgr/libsnapshot/snapuserd/user-space-merge/snapuserd_verify.cpp","contentType":"file"}],"totalCount":10},"fs_mgr/libsnapshot/snapuserd":{"items":[{"name":"dm-snapshot-merge","path":"fs_mgr/libsnapshot/snapuserd/dm-snapshot-merge","contentType":"directory"},{"name":"include","path":"fs_mgr/libsnapshot/snapuserd/include","contentType":"directory"},{"name":"user-space-merge","path":"fs_mgr/libsnapshot/snapuserd/user-space-merge","contentType":"directory"},{"name":"Android.bp","path":"fs_mgr/libsnapshot/snapuserd/Android.bp","contentType":"file"},{"name":"OWNERS","path":"fs_mgr/libsnapshot/snapuserd/OWNERS","contentType":"file"},{"name":"snapuserd.rc","path":"fs_mgr/libsnapshot/snapuserd/snapuserd.rc","contentType":"file"},{"name":"snapuserd_buffer.cpp","path":"fs_mgr/libsnapshot/snapuserd/snapuserd_buffer.cpp","contentType":"file"},{"name":"snapuserd_client.cpp","path":"fs_mgr/libsnapshot/snapuserd/snapuserd_client.cpp","contentType":"file"},{"name":"snapuserd_daemon.cpp","path":"fs_mgr/libsnapshot/snapuserd/snapuserd_daemon.cpp","contentType":"file"},{"name":"snapuserd_daemon.h","path":"fs_mgr/libsnapshot/snapuserd/snapuserd_daemon.h","contentType":"file"}],"totalCount":10},"fs_mgr/libsnapshot":{"items":[{"name":"android","path":"fs_mgr/libsnapshot/android","contentType":"directory"},{"name":"corpus","path":"fs_mgr/libsnapshot/corpus","contentType":"directory"},{"name":"include","path":"fs_mgr/libsnapshot/include","contentType":"directory"},{"name":"include_test","path":"fs_mgr/libsnapshot/include_test","contentType":"directory"},{"name":"scripts","path":"fs_mgr/libsnapshot/scripts","contentType":"directory"},{"name":"snapuserd","path":"fs_mgr/libsnapshot/snapuserd","contentType":"directory"},{"name":"update_engine","path":"fs_mgr/libsnapshot/update_engine","contentType":"directory"},{"name":"Android.bp","path":"fs_mgr/libsnapshot/Android.bp","contentType":"file"},{"name":"OWNERS","path":"fs_mgr/libsnapshot/OWNERS","contentType":"file"},{"name":"PowerTest.md","path":"fs_mgr/libsnapshot/PowerTest.md","contentType":"file"},{"name":"cow_api_test.cpp","path":"fs_mgr/libsnapshot/cow_api_test.cpp","contentType":"file"},{"name":"cow_decompress.cpp","path":"fs_mgr/libsnapshot/cow_decompress.cpp","contentType":"file"},{"name":"cow_decompress.h","path":"fs_mgr/libsnapshot/cow_decompress.h","contentType":"file"},{"name":"cow_format.cpp","path":"fs_mgr/libsnapshot/cow_format.cpp","contentType":"file"},{"name":"cow_reader.cpp","path":"fs_mgr/libsnapshot/cow_reader.cpp","contentType":"file"},{"name":"cow_writer.cpp","path":"fs_mgr/libsnapshot/cow_writer.cpp","contentType":"file"},{"name":"device_info.cpp","path":"fs_mgr/libsnapshot/device_info.cpp","contentType":"file"},{"name":"device_info.h","path":"fs_mgr/libsnapshot/device_info.h","contentType":"file"},{"name":"dm_snapshot_internals.h","path":"fs_mgr/libsnapshot/dm_snapshot_internals.h","contentType":"file"},{"name":"estimate_cow_from_nonab_ota.cpp","path":"fs_mgr/libsnapshot/estimate_cow_from_nonab_ota.cpp","contentType":"file"},{"name":"fuzz.sh","path":"fs_mgr/libsnapshot/fuzz.sh","contentType":"file"},{"name":"fuzz_utils.cpp","path":"fs_mgr/libsnapshot/fuzz_utils.cpp","contentType":"file"},{"name":"fuzz_utils.h","path":"fs_mgr/libsnapshot/fuzz_utils.h","contentType":"file"},{"name":"inspect_cow.cpp","path":"fs_mgr/libsnapshot/inspect_cow.cpp","contentType":"file"},{"name":"make_cow_from_ab_ota.cpp","path":"fs_mgr/libsnapshot/make_cow_from_ab_ota.cpp","contentType":"file"},{"name":"partition_cow_creator.cpp","path":"fs_mgr/libsnapshot/partition_cow_creator.cpp","contentType":"file"},{"name":"partition_cow_creator.h","path":"fs_mgr/libsnapshot/partition_cow_creator.h","contentType":"file"},{"name":"partition_cow_creator_test.cpp","path":"fs_mgr/libsnapshot/partition_cow_creator_test.cpp","contentType":"file"},{"name":"power_test.cpp","path":"fs_mgr/libsnapshot/power_test.cpp","contentType":"file"},{"name":"return.cpp","path":"fs_mgr/libsnapshot/return.cpp","contentType":"file"},{"name":"run_power_test.sh","path":"fs_mgr/libsnapshot/run_power_test.sh","contentType":"file"},{"name":"run_snapshot_tests.sh","path":"fs_mgr/libsnapshot/run_snapshot_tests.sh","contentType":"file"},{"name":"snapshot.cpp","path":"fs_mgr/libsnapshot/snapshot.cpp","contentType":"file"},{"name":"snapshot_fuzz.cpp","path":"fs_mgr/libsnapshot/snapshot_fuzz.cpp","contentType":"file"},{"name":"snapshot_fuzz_utils.cpp","path":"fs_mgr/libsnapshot/snapshot_fuzz_utils.cpp","contentType":"file"},{"name":"snapshot_fuzz_utils.h","path":"fs_mgr/libsnapshot/snapshot_fuzz_utils.h","contentType":"file"},{"name":"snapshot_metadata_updater.cpp","path":"fs_mgr/libsnapshot/snapshot_metadata_updater.cpp","contentType":"file"},{"name":"snapshot_metadata_updater.h","path":"fs_mgr/libsnapshot/snapshot_metadata_updater.h","contentType":"file"},{"name":"snapshot_metadata_updater_test.cpp","path":"fs_mgr/libsnapshot/snapshot_metadata_updater_test.cpp","contentType":"file"},{"name":"snapshot_reader.cpp","path":"fs_mgr/libsnapshot/snapshot_reader.cpp","contentType":"file"},{"name":"snapshot_reader.h","path":"fs_mgr/libsnapshot/snapshot_reader.h","contentType":"file"},{"name":"snapshot_reader_test.cpp","path":"fs_mgr/libsnapshot/snapshot_reader_test.cpp","contentType":"file"},{"name":"snapshot_stats.cpp","path":"fs_mgr/libsnapshot/snapshot_stats.cpp","contentType":"file"},{"name":"snapshot_stub.cpp","path":"fs_mgr/libsnapshot/snapshot_stub.cpp","contentType":"file"},{"name":"snapshot_test.cpp","path":"fs_mgr/libsnapshot/snapshot_test.cpp","contentType":"file"},{"name":"snapshot_writer.cpp","path":"fs_mgr/libsnapshot/snapshot_writer.cpp","contentType":"file"},{"name":"snapshot_writer_test.cpp","path":"fs_mgr/libsnapshot/snapshot_writer_test.cpp","contentType":"file"},{"name":"snapshotctl.cpp","path":"fs_mgr/libsnapshot/snapshotctl.cpp","contentType":"file"},{"name":"test_helpers.cpp","path":"fs_mgr/libsnapshot/test_helpers.cpp","contentType":"file"},{"name":"utility.cpp","path":"fs_mgr/libsnapshot/utility.cpp","contentType":"file"},{"name":"utility.h","path":"fs_mgr/libsnapshot/utility.h","contentType":"file"},{"name":"vts_ota_config_test.cpp","path":"fs_mgr/libsnapshot/vts_ota_config_test.cpp","contentType":"file"}],"totalCount":52},"fs_mgr":{"items":[{"name":"fuzz","path":"fs_mgr/fuzz","contentType":"directory"},{"name":"include","path":"fs_mgr/include","contentType":"directory"},{"name":"include_fstab","path":"fs_mgr/include_fstab","contentType":"directory"},{"name":"libdm","path":"fs_mgr/libdm","contentType":"directory"},{"name":"libfiemap","path":"fs_mgr/libfiemap","contentType":"directory"},{"name":"libfs_avb","path":"fs_mgr/libfs_avb","contentType":"directory"},{"name":"liblp","path":"fs_mgr/liblp","contentType":"directory"},{"name":"libsnapshot","path":"fs_mgr/libsnapshot","contentType":"directory"},{"name":"libstorage_literals","path":"fs_mgr/libstorage_literals","contentType":"directory"},{"name":"libvbmeta","path":"fs_mgr/libvbmeta","contentType":"directory"},{"name":"tests","path":"fs_mgr/tests","contentType":"directory"},{"name":"tools","path":"fs_mgr/tools","contentType":"directory"},{"name":".clang-format","path":"fs_mgr/.clang-format","contentType":"symlink_file"},{"name":"Android.bp","path":"fs_mgr/Android.bp","contentType":"file"},{"name":"NOTICE","path":"fs_mgr/NOTICE","contentType":"file"},{"name":"OWNERS","path":"fs_mgr/OWNERS","contentType":"file"},{"name":"README.overlayfs.md","path":"fs_mgr/README.overlayfs.md","contentType":"file"},{"name":"TEST_MAPPING","path":"fs_mgr/TEST_MAPPING","contentType":"file"},{"name":"blockdev.cpp","path":"fs_mgr/blockdev.cpp","contentType":"file"},{"name":"blockdev.h","path":"fs_mgr/blockdev.h","contentType":"file"},{"name":"clean_scratch_files.rc","path":"fs_mgr/clean_scratch_files.rc","contentType":"file"},{"name":"file_wait.cpp","path":"fs_mgr/file_wait.cpp","contentType":"file"},{"name":"fs_mgr.cpp","path":"fs_mgr/fs_mgr.cpp","contentType":"file"},{"name":"fs_mgr_boot_config.cpp","path":"fs_mgr/fs_mgr_boot_config.cpp","contentType":"file"},{"name":"fs_mgr_dm_linear.cpp","path":"fs_mgr/fs_mgr_dm_linear.cpp","contentType":"file"},{"name":"fs_mgr_format.cpp","path":"fs_mgr/fs_mgr_format.cpp","contentType":"file"},{"name":"fs_mgr_fstab.cpp","path":"fs_mgr/fs_mgr_fstab.cpp","contentType":"file"},{"name":"fs_mgr_overlayfs.cpp","path":"fs_mgr/fs_mgr_overlayfs.cpp","contentType":"file"},{"name":"fs_mgr_priv.h","path":"fs_mgr/fs_mgr_priv.h","contentType":"file"},{"name":"fs_mgr_priv_boot_config.h","path":"fs_mgr/fs_mgr_priv_boot_config.h","contentType":"file"},{"name":"fs_mgr_remount.cpp","path":"fs_mgr/fs_mgr_remount.cpp","contentType":"file"},{"name":"fs_mgr_roots.cpp","path":"fs_mgr/fs_mgr_roots.cpp","contentType":"file"},{"name":"fs_mgr_slotselect.cpp","path":"fs_mgr/fs_mgr_slotselect.cpp","contentType":"file"},{"name":"fs_mgr_vendor_overlay.cpp","path":"fs_mgr/fs_mgr_vendor_overlay.cpp","contentType":"file"}],"totalCount":34},"":{"items":[{"name":"bootstat","path":"bootstat","contentType":"directory"},{"name":"cli-test","path":"cli-test","contentType":"directory"},{"name":"code_coverage","path":"code_coverage","contentType":"directory"},{"name":"debuggerd","path":"debuggerd","contentType":"directory"},{"name":"diagnose_usb","path":"diagnose_usb","contentType":"directory"},{"name":"fastboot","path":"fastboot","contentType":"directory"},{"name":"fs_mgr","path":"fs_mgr","contentType":"directory"},{"name":"gatekeeperd","path":"gatekeeperd","contentType":"directory"},{"name":"healthd","path":"healthd","contentType":"directory"},{"name":"include","path":"include","contentType":"directory"},{"name":"init","path":"init","contentType":"directory"},{"name":"janitors","path":"janitors","contentType":"directory"},{"name":"libappfuse","path":"libappfuse","contentType":"directory"},{"name":"libasyncio","path":"libasyncio","contentType":"directory"},{"name":"libbinderwrapper","path":"libbinderwrapper","contentType":"directory"},{"name":"libcrypto_utils","path":"libcrypto_utils","contentType":"directory"},{"name":"libcutils","path":"libcutils","contentType":"directory"},{"name":"libdiskconfig","path":"libdiskconfig","contentType":"directory"},{"name":"libgrallocusage","path":"libgrallocusage","contentType":"directory"},{"name":"libkeyutils","path":"libkeyutils","contentType":"directory"},{"name":"libmodprobe","path":"libmodprobe","contentType":"directory"},{"name":"libnetutils","path":"libnetutils","contentType":"directory"},{"name":"libpackagelistparser","path":"libpackagelistparser","contentType":"directory"},{"name":"libprocessgroup","path":"libprocessgroup","contentType":"directory"},{"name":"libsparse","path":"libsparse","contentType":"directory"},{"name":"libstats","path":"libstats","contentType":"directory"},{"name":"libsuspend","path":"libsuspend","contentType":"directory"},{"name":"libsync","path":"libsync","contentType":"directory"},{"name":"libsystem","path":"libsystem","contentType":"directory"},{"name":"libsysutils","path":"libsysutils","contentType":"directory"},{"name":"libusbhost","path":"libusbhost","contentType":"directory"},{"name":"libutils","path":"libutils","contentType":"directory"},{"name":"libvndksupport","path":"libvndksupport","contentType":"directory"},{"name":"llkd","path":"llkd","contentType":"directory"},{"name":"mini_keyctl","path":"mini_keyctl","contentType":"directory"},{"name":"mkbootfs","path":"mkbootfs","contentType":"directory"},{"name":"property_service","path":"property_service","contentType":"directory"},{"name":"reboot","path":"reboot","contentType":"directory"},{"name":"rootdir","path":"rootdir","contentType":"directory"},{"name":"run-as","path":"run-as","contentType":"directory"},{"name":"sdcard","path":"sdcard","contentType":"directory"},{"name":"set-verity-state","path":"set-verity-state","contentType":"directory"},{"name":"shell_and_utilities","path":"shell_and_utilities","contentType":"directory"},{"name":"storaged","path":"storaged","contentType":"directory"},{"name":"toolbox","path":"toolbox","contentType":"directory"},{"name":"trusty","path":"trusty","contentType":"directory"},{"name":"usbd","path":"usbd","contentType":"directory"},{"name":"watchdogd","path":"watchdogd","contentType":"directory"},{"name":".clang-format","path":".clang-format","contentType":"symlink_file"},{"name":".clang-format-2","path":".clang-format-2","contentType":"symlink_file"},{"name":".clang-format-4","path":".clang-format-4","contentType":"symlink_file"},{"name":".gitignore","path":".gitignore","contentType":"file"},{"name":"CleanSpec.mk","path":"CleanSpec.mk","contentType":"file"},{"name":"METADATA","path":"METADATA","contentType":"file"},{"name":"MODULE_LICENSE_APACHE2","path":"MODULE_LICENSE_APACHE2","contentType":"file"},{"name":"OWNERS","path":"OWNERS","contentType":"file"},{"name":"PREUPLOAD.cfg","path":"PREUPLOAD.cfg","contentType":"file"},{"name":"rustfmt.toml","path":"rustfmt.toml","contentType":"symlink_file"}],"totalCount":58}},"fileTreeProcessingTime":10.947981,"foldersToFetch":[],"reducedMotionEnabled":null,"repo":{"id":354093509,"defaultBranch":"14","name":"system_core","ownerLogin":"VoltageOS","currentUserCanPush":false,"isFork":true,"isEmpty":false,"createdAt":"2021-04-02T17:53:23.000Z","ownerAvatar":"https://avatars.githubusercontent.com/u/81792437?v=4","public":true,"private":false,"isOrgOwned":true},"symbolsExpanded":false,"treeExpanded":true,"refInfo":{"name":"13","listCacheKey":"v0:1699348162.0","canEdit":false,"refType":"branch","currentOid":"a73550ecf5798652884c95d4f64e851956ed8ce9"},"path":"fs_mgr/libsnapshot/snapuserd/user-space-merge/snapuserd_verify.cpp","currentUser":null,"blob":{"rawLines":["/*"," * Copyright (C) 2022 The Android Open Source Project"," *"," * Licensed under the Apache License, Version 2.0 (the \"License\");"," * you may not use this file except in compliance with the License."," * You may obtain a copy of the License at"," *"," *      http://www.apache.org/licenses/LICENSE-2.0"," *"," * Unless required by applicable law or agreed to in writing, software"," * distributed under the License is distributed on an \"AS IS\" BASIS,"," * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied."," * See the License for the specific language governing permissions and"," * limitations under the License."," */","","#include \"snapuserd_core.h\"","","#include <android-base/chrono_utils.h>","#include <android-base/scopeguard.h>","#include <android-base/strings.h>","","namespace android {","namespace snapshot {","","using namespace android;","using namespace android::dm;","using android::base::unique_fd;","","UpdateVerify::UpdateVerify(const std::string& misc_name)","    : misc_name_(misc_name), state_(UpdateVerifyState::VERIFY_UNKNOWN) {}","","bool UpdateVerify::CheckPartitionVerification() {","    auto now = std::chrono::system_clock::now();","    auto deadline = now + 10s;","    {","        std::unique_lock<std::mutex> cv_lock(m_lock_);","        while (state_ == UpdateVerifyState::VERIFY_UNKNOWN) {","            auto status = m_cv_.wait_until(cv_lock, deadline);","            if (status == std::cv_status::timeout) {","                return false;","            }","        }","    }","","    return (state_ == UpdateVerifyState::VERIFY_SUCCESS);","}","","void UpdateVerify::UpdatePartitionVerificationState(UpdateVerifyState state) {","    {","        std::lock_guard<std::mutex> lock(m_lock_);","        state_ = state;","    }","    m_cv_.notify_all();","}","","void UpdateVerify::VerifyUpdatePartition() {","    bool succeeded = false;","","    auto scope_guard = android::base::make_scope_guard([this, &succeeded]() -> void {","        if (!succeeded) {","            UpdatePartitionVerificationState(UpdateVerifyState::VERIFY_FAILED);","        }","    });","","    auto& dm = DeviceMapper::Instance();","    auto dm_block_devices = dm.FindDmPartitions();","    if (dm_block_devices.empty()) {","        SNAP_LOG(ERROR) << \"No dm-enabled block device is found.\";","        return;","    }","","    const auto parts = android::base::Split(misc_name_, \"-\");","    std::string partition_name = parts[0];","","    constexpr auto&& suffix_b = \"_b\";","    constexpr auto&& suffix_a = \"_a\";","","    partition_name.erase(partition_name.find_last_not_of(suffix_b) + 1);","    partition_name.erase(partition_name.find_last_not_of(suffix_a) + 1);","","    if (dm_block_devices.find(partition_name) == dm_block_devices.end()) {","        SNAP_LOG(ERROR) << \"Failed to find dm block device for \" << partition_name;","        return;","    }","","    if (!VerifyPartition(partition_name, dm_block_devices.at(partition_name))) {","        SNAP_LOG(ERROR) << \"Partition: \" << partition_name","                        << \" Block-device: \" << dm_block_devices.at(partition_name)","                        << \" verification failed\";","    }","    succeeded = true;","}","","bool UpdateVerify::VerifyBlocks(const std::string& partition_name,","                                const std::string& dm_block_device, off_t offset, int skip_blocks,","                                uint64_t dev_sz) {","    unique_fd fd(TEMP_FAILURE_RETRY(open(dm_block_device.c_str(), O_RDONLY | O_DIRECT)));","    if (fd < 0) {","        SNAP_LOG(ERROR) << \"open failed: \" << dm_block_device;","        return false;","    }","","    loff_t file_offset = offset;","    const uint64_t read_sz = kBlockSizeVerify;","","    void* addr;","    ssize_t page_size = getpagesize();","    if (posix_memalign(&addr, page_size, read_sz) < 0) {","        SNAP_PLOG(ERROR) << \"posix_memalign failed \"","                         << \" page_size: \" << page_size << \" read_sz: \" << read_sz;","        return false;","    }","","    std::unique_ptr<void, decltype(&::free)> buffer(addr, ::free);","","    uint64_t bytes_read = 0;","","    while (true) {","        size_t to_read = std::min((dev_sz - file_offset), read_sz);","","        if (!android::base::ReadFullyAtOffset(fd.get(), buffer.get(), to_read, file_offset)) {","            SNAP_PLOG(ERROR) << \"Failed to read block from block device: \" << dm_block_device","                             << \" partition-name: \" << partition_name","                             << \" at offset: \" << file_offset << \" read-size: \" << to_read","                             << \" block-size: \" << dev_sz;","            return false;","        }","","        bytes_read += to_read;","        file_offset += (skip_blocks * kBlockSizeVerify);","        if (file_offset >= dev_sz) {","            break;","        }","    }","","    SNAP_LOG(DEBUG) << \"Verification success with bytes-read: \" << bytes_read","                    << \" dev_sz: \" << dev_sz << \" partition_name: \" << partition_name;","","    return true;","}","","bool UpdateVerify::VerifyPartition(const std::string& partition_name,","                                   const std::string& dm_block_device) {","    android::base::Timer timer;","","    SNAP_LOG(INFO) << \"VerifyPartition: \" << partition_name << \" Block-device: \" << dm_block_device;","","    bool succeeded = false;","    auto scope_guard = android::base::make_scope_guard([this, &succeeded]() -> void {","        if (!succeeded) {","            UpdatePartitionVerificationState(UpdateVerifyState::VERIFY_FAILED);","        }","    });","","    unique_fd fd(TEMP_FAILURE_RETRY(open(dm_block_device.c_str(), O_RDONLY | O_DIRECT)));","    if (fd < 0) {","        SNAP_LOG(ERROR) << \"open failed: \" << dm_block_device;","        return false;","    }","","    uint64_t dev_sz = get_block_device_size(fd.get());","    if (!dev_sz) {","        SNAP_PLOG(ERROR) << \"Could not determine block device size: \" << dm_block_device;","        return false;","    }","","    if (!IsBlockAligned(dev_sz)) {","        SNAP_LOG(ERROR) << \"dev_sz: \" << dev_sz << \" is not block aligned\";","        return false;","    }","","    /*","     * Not all partitions are of same size. Some partitions are as small as","     * 100Mb. We can just finish them in a single thread. For bigger partitions","     * such as product, 4 threads are sufficient enough.","     *","     * TODO: With io_uring SQ_POLL support, we can completely cut this","     * down to just single thread for all partitions and potentially verify all","     * the partitions with zero syscalls. Additionally, since block layer","     * supports polling, IO_POLL could be used which will further cut down","     * latency.","     */","    int num_threads = kMinThreadsToVerify;","    if (dev_sz > kThresholdSize) {","        num_threads = kMaxThreadsToVerify;","    }","","    std::vector<std::future<bool>> threads;","    off_t start_offset = 0;","    const int skip_blocks = num_threads;","","    while (num_threads) {","        threads.emplace_back(std::async(std::launch::async, &UpdateVerify::VerifyBlocks, this,","                                        partition_name, dm_block_device, start_offset, skip_blocks,","                                        dev_sz));","        start_offset += kBlockSizeVerify;","        num_threads -= 1;","        if (start_offset >= dev_sz) {","            break;","        }","    }","","    bool ret = true;","    for (auto& t : threads) {","        ret = t.get() && ret;","    }","","    if (ret) {","        succeeded = true;","        UpdatePartitionVerificationState(UpdateVerifyState::VERIFY_SUCCESS);","        SNAP_LOG(INFO) << \"Partition: \" << partition_name << \" Block-device: \" << dm_block_device","                       << \" Size: \" << dev_sz","                       << \" verification success. Duration : \" << timer.duration().count() << \" ms\";","        return true;","    }","","    return false;","}","","}  // namespace snapshot","}  // namespace android"],"stylingDirectives":[[{"start":0,"end":2,"cssClass":"pl-c"},{"start":0,"end":2,"cssClass":"pl-c"}],[{"start":0,"end":53,"cssClass":"pl-c"}],[{"start":0,"end":2,"cssClass":"pl-c"}],[{"start":0,"end":66,"cssClass":"pl-c"}],[{"start":0,"end":67,"cssClass":"pl-c"}],[{"start":0,"end":42,"cssClass":"pl-c"}],[{"start":0,"end":2,"cssClass":"pl-c"}],[{"start":0,"end":50,"cssClass":"pl-c"}],[{"start":0,"end":2,"cssClass":"pl-c"}],[{"start":0,"end":70,"cssClass":"pl-c"}],[{"start":0,"end":68,"cssClass":"pl-c"}],[{"start":0,"end":75,"cssClass":"pl-c"}],[{"start":0,"end":70,"cssClass":"pl-c"}],[{"start":0,"end":33,"cssClass":"pl-c"}],[{"start":0,"end":3,"cssClass":"pl-c"},{"start":1,"end":3,"cssClass":"pl-c"}],[],[{"start":1,"end":8,"cssClass":"pl-k"},{"start":9,"end":27,"cssClass":"pl-s"},{"start":9,"end":10,"cssClass":"pl-pds"},{"start":26,"end":27,"cssClass":"pl-pds"}],[],[{"start":1,"end":8,"cssClass":"pl-k"},{"start":9,"end":38,"cssClass":"pl-s"},{"start":9,"end":10,"cssClass":"pl-pds"},{"start":37,"end":38,"cssClass":"pl-pds"}],[{"start":1,"end":8,"cssClass":"pl-k"},{"start":9,"end":36,"cssClass":"pl-s"},{"start":9,"end":10,"cssClass":"pl-pds"},{"start":35,"end":36,"cssClass":"pl-pds"}],[{"start":1,"end":8,"cssClass":"pl-k"},{"start":9,"end":33,"cssClass":"pl-s"},{"start":9,"end":10,"cssClass":"pl-pds"},{"start":32,"end":33,"cssClass":"pl-pds"}],[],[{"start":0,"end":9,"cssClass":"pl-k"},{"start":10,"end":17,"cssClass":"pl-en"}],[{"start":0,"end":9,"cssClass":"pl-k"},{"start":10,"end":18,"cssClass":"pl-en"}],[],[{"start":0,"end":5,"cssClass":"pl-k"},{"start":6,"end":15,"cssClass":"pl-k"},{"start":16,"end":23,"cssClass":"pl-en"},{"start":23,"end":24,"cssClass":"pl-k"}],[{"start":0,"end":5,"cssClass":"pl-k"},{"start":6,"end":15,"cssClass":"pl-k"},{"start":16,"end":23,"cssClass":"pl-en"},{"start":27,"end":28,"cssClass":"pl-k"}],[{"start":0,"end":5,"cssClass":"pl-k"}],[],[{"start":0,"end":26,"cssClass":"pl-en"},{"start":27,"end":32,"cssClass":"pl-k"}],[],[],[{"start":0,"end":4,"cssClass":"pl-k"},{"start":5,"end":45,"cssClass":"pl-en"}],[{"start":4,"end":8,"cssClass":"pl-k"},{"start":15,"end":45,"cssClass":"pl-c1"}],[{"start":4,"end":8,"cssClass":"pl-k"}],[],[{"start":37,"end":44,"cssClass":"pl-c1"}],[{"start":8,"end":13,"cssClass":"pl-k"}],[{"start":12,"end":16,"cssClass":"pl-k"},{"start":32,"end":42,"cssClass":"pl-c1"}],[{"start":12,"end":14,"cssClass":"pl-k"}],[{"start":16,"end":22,"cssClass":"pl-k"},{"start":23,"end":28,"cssClass":"pl-c1"}],[],[],[],[],[{"start":4,"end":10,"cssClass":"pl-k"}],[],[],[{"start":0,"end":4,"cssClass":"pl-k"},{"start":5,"end":51,"cssClass":"pl-en"}],[],[{"start":36,"end":40,"cssClass":"pl-c1"}],[],[],[{"start":10,"end":20,"cssClass":"pl-c1"}],[],[],[{"start":0,"end":4,"cssClass":"pl-k"},{"start":5,"end":40,"cssClass":"pl-en"}],[{"start":4,"end":8,"cssClass":"pl-k"},{"start":21,"end":26,"cssClass":"pl-c1"}],[],[{"start":4,"end":8,"cssClass":"pl-k"},{"start":23,"end":54,"cssClass":"pl-c1"},{"start":56,"end":60,"cssClass":"pl-c1"},{"start":79,"end":83,"cssClass":"pl-k"}],[{"start":8,"end":10,"cssClass":"pl-k"}],[{"start":12,"end":44,"cssClass":"pl-c1"}],[],[],[],[{"start":4,"end":8,"cssClass":"pl-k"},{"start":15,"end":37,"cssClass":"pl-c1"}],[{"start":4,"end":8,"cssClass":"pl-k"},{"start":31,"end":47,"cssClass":"pl-c1"}],[{"start":4,"end":6,"cssClass":"pl-k"},{"start":25,"end":30,"cssClass":"pl-c1"}],[{"start":8,"end":16,"cssClass":"pl-c1"},{"start":27,"end":65,"cssClass":"pl-s"},{"start":27,"end":28,"cssClass":"pl-pds"},{"start":64,"end":65,"cssClass":"pl-pds"}],[{"start":8,"end":14,"cssClass":"pl-k"}],[],[],[{"start":4,"end":9,"cssClass":"pl-k"},{"start":10,"end":14,"cssClass":"pl-k"},{"start":23,"end":43,"cssClass":"pl-c1"},{"start":56,"end":59,"cssClass":"pl-s"},{"start":56,"end":57,"cssClass":"pl-pds"},{"start":58,"end":59,"cssClass":"pl-pds"}],[{"start":39,"end":40,"cssClass":"pl-c1"}],[],[{"start":4,"end":13,"cssClass":"pl-k"},{"start":14,"end":18,"cssClass":"pl-k"},{"start":32,"end":36,"cssClass":"pl-s"},{"start":32,"end":33,"cssClass":"pl-pds"},{"start":35,"end":36,"cssClass":"pl-pds"}],[{"start":4,"end":13,"cssClass":"pl-k"},{"start":14,"end":18,"cssClass":"pl-k"},{"start":32,"end":36,"cssClass":"pl-s"},{"start":32,"end":33,"cssClass":"pl-pds"},{"start":35,"end":36,"cssClass":"pl-pds"}],[],[{"start":19,"end":24,"cssClass":"pl-c1"},{"start":40,"end":56,"cssClass":"pl-c1"},{"start":69,"end":70,"cssClass":"pl-c1"}],[{"start":19,"end":24,"cssClass":"pl-c1"},{"start":40,"end":56,"cssClass":"pl-c1"},{"start":69,"end":70,"cssClass":"pl-c1"}],[],[{"start":4,"end":6,"cssClass":"pl-k"},{"start":25,"end":29,"cssClass":"pl-c1"},{"start":66,"end":69,"cssClass":"pl-c1"}],[{"start":8,"end":16,"cssClass":"pl-c1"},{"start":27,"end":64,"cssClass":"pl-s"},{"start":27,"end":28,"cssClass":"pl-pds"},{"start":63,"end":64,"cssClass":"pl-pds"}],[{"start":8,"end":14,"cssClass":"pl-k"}],[],[],[{"start":4,"end":6,"cssClass":"pl-k"},{"start":9,"end":24,"cssClass":"pl-c1"},{"start":58,"end":60,"cssClass":"pl-c1"}],[{"start":8,"end":16,"cssClass":"pl-c1"},{"start":27,"end":40,"cssClass":"pl-s"},{"start":27,"end":28,"cssClass":"pl-pds"},{"start":39,"end":40,"cssClass":"pl-pds"}],[{"start":27,"end":44,"cssClass":"pl-s"},{"start":27,"end":28,"cssClass":"pl-pds"},{"start":43,"end":44,"cssClass":"pl-pds"},{"start":65,"end":67,"cssClass":"pl-c1"}],[{"start":27,"end":49,"cssClass":"pl-s"},{"start":27,"end":28,"cssClass":"pl-pds"},{"start":48,"end":49,"cssClass":"pl-pds"}],[],[{"start":16,"end":20,"cssClass":"pl-c1"}],[],[],[{"start":0,"end":4,"cssClass":"pl-k"},{"start":5,"end":31,"cssClass":"pl-en"},{"start":32,"end":37,"cssClass":"pl-k"}],[{"start":32,"end":37,"cssClass":"pl-k"},{"start":68,"end":73,"cssClass":"pl-c1"},{"start":82,"end":85,"cssClass":"pl-k"}],[{"start":32,"end":40,"cssClass":"pl-c1"}],[{"start":14,"end":16,"cssClass":"pl-smi"},{"start":17,"end":35,"cssClass":"pl-c1"},{"start":36,"end":40,"cssClass":"pl-c1"},{"start":57,"end":62,"cssClass":"pl-c1"}],[{"start":4,"end":6,"cssClass":"pl-k"},{"start":13,"end":14,"cssClass":"pl-c1"}],[{"start":8,"end":16,"cssClass":"pl-c1"},{"start":27,"end":42,"cssClass":"pl-s"},{"start":27,"end":28,"cssClass":"pl-pds"},{"start":41,"end":42,"cssClass":"pl-pds"}],[{"start":8,"end":14,"cssClass":"pl-k"},{"start":15,"end":20,"cssClass":"pl-c1"}],[],[],[{"start":4,"end":10,"cssClass":"pl-c1"}],[{"start":4,"end":9,"cssClass":"pl-k"},{"start":10,"end":18,"cssClass":"pl-c1"},{"start":29,"end":45,"cssClass":"pl-c1"}],[],[{"start":4,"end":8,"cssClass":"pl-k"}],[{"start":4,"end":11,"cssClass":"pl-c1"},{"start":24,"end":35,"cssClass":"pl-c1"}],[{"start":4,"end":6,"cssClass":"pl-k"},{"start":8,"end":22,"cssClass":"pl-c1"},{"start":52,"end":53,"cssClass":"pl-c1"}],[{"start":8,"end":17,"cssClass":"pl-c1"},{"start":28,"end":52,"cssClass":"pl-s"},{"start":28,"end":29,"cssClass":"pl-pds"},{"start":51,"end":52,"cssClass":"pl-pds"}],[{"start":28,"end":42,"cssClass":"pl-s"},{"start":28,"end":29,"cssClass":"pl-pds"},{"start":41,"end":42,"cssClass":"pl-pds"},{"start":59,"end":71,"cssClass":"pl-s"},{"start":59,"end":60,"cssClass":"pl-pds"},{"start":70,"end":71,"cssClass":"pl-pds"}],[{"start":8,"end":14,"cssClass":"pl-k"},{"start":15,"end":20,"cssClass":"pl-c1"}],[],[],[{"start":20,"end":24,"cssClass":"pl-k"},{"start":26,"end":34,"cssClass":"pl-c1"},{"start":45,"end":51,"cssClass":"pl-c1"}],[],[{"start":4,"end":12,"cssClass":"pl-c1"},{"start":26,"end":27,"cssClass":"pl-c1"}],[],[{"start":4,"end":9,"cssClass":"pl-k"},{"start":11,"end":15,"cssClass":"pl-c1"}],[{"start":8,"end":14,"cssClass":"pl-c1"},{"start":25,"end":33,"cssClass":"pl-c1"}],[],[{"start":8,"end":10,"cssClass":"pl-k"},{"start":13,"end":45,"cssClass":"pl-c1"},{"start":49,"end":52,"cssClass":"pl-c1"},{"start":63,"end":66,"cssClass":"pl-c1"}],[{"start":12,"end":21,"cssClass":"pl-c1"},{"start":32,"end":74,"cssClass":"pl-s"},{"start":32,"end":33,"cssClass":"pl-pds"},{"start":73,"end":74,"cssClass":"pl-pds"}],[{"start":32,"end":51,"cssClass":"pl-s"},{"start":32,"end":33,"cssClass":"pl-pds"},{"start":50,"end":51,"cssClass":"pl-pds"}],[{"start":32,"end":46,"cssClass":"pl-s"},{"start":32,"end":33,"cssClass":"pl-pds"},{"start":45,"end":46,"cssClass":"pl-pds"},{"start":65,"end":79,"cssClass":"pl-s"},{"start":65,"end":66,"cssClass":"pl-pds"},{"start":78,"end":79,"cssClass":"pl-pds"}],[{"start":32,"end":47,"cssClass":"pl-s"},{"start":32,"end":33,"cssClass":"pl-pds"},{"start":46,"end":47,"cssClass":"pl-pds"}],[{"start":12,"end":18,"cssClass":"pl-k"},{"start":19,"end":24,"cssClass":"pl-c1"}],[],[],[],[{"start":38,"end":54,"cssClass":"pl-c1"}],[{"start":8,"end":10,"cssClass":"pl-k"}],[{"start":12,"end":17,"cssClass":"pl-k"}],[],[],[],[{"start":4,"end":12,"cssClass":"pl-c1"},{"start":23,"end":63,"cssClass":"pl-s"},{"start":23,"end":24,"cssClass":"pl-pds"},{"start":62,"end":63,"cssClass":"pl-pds"}],[{"start":23,"end":34,"cssClass":"pl-s"},{"start":23,"end":24,"cssClass":"pl-pds"},{"start":33,"end":34,"cssClass":"pl-pds"},{"start":48,"end":67,"cssClass":"pl-s"},{"start":48,"end":49,"cssClass":"pl-pds"},{"start":66,"end":67,"cssClass":"pl-pds"}],[],[{"start":4,"end":10,"cssClass":"pl-k"},{"start":11,"end":15,"cssClass":"pl-c1"}],[],[],[{"start":0,"end":4,"cssClass":"pl-k"},{"start":5,"end":34,"cssClass":"pl-en"},{"start":35,"end":40,"cssClass":"pl-k"}],[{"start":35,"end":40,"cssClass":"pl-k"}],[],[],[{"start":4,"end":12,"cssClass":"pl-c1"},{"start":22,"end":41,"cssClass":"pl-s"},{"start":22,"end":23,"cssClass":"pl-pds"},{"start":40,"end":41,"cssClass":"pl-pds"},{"start":63,"end":80,"cssClass":"pl-s"},{"start":63,"end":64,"cssClass":"pl-pds"},{"start":79,"end":80,"cssClass":"pl-pds"}],[],[{"start":4,"end":8,"cssClass":"pl-k"},{"start":21,"end":26,"cssClass":"pl-c1"}],[{"start":4,"end":8,"cssClass":"pl-k"},{"start":23,"end":54,"cssClass":"pl-c1"},{"start":56,"end":60,"cssClass":"pl-c1"},{"start":79,"end":83,"cssClass":"pl-k"}],[{"start":8,"end":10,"cssClass":"pl-k"}],[{"start":12,"end":44,"cssClass":"pl-c1"}],[],[],[],[{"start":14,"end":16,"cssClass":"pl-smi"},{"start":17,"end":35,"cssClass":"pl-c1"},{"start":36,"end":40,"cssClass":"pl-c1"},{"start":57,"end":62,"cssClass":"pl-c1"}],[{"start":4,"end":6,"cssClass":"pl-k"},{"start":13,"end":14,"cssClass":"pl-c1"}],[{"start":8,"end":16,"cssClass":"pl-c1"},{"start":27,"end":42,"cssClass":"pl-s"},{"start":27,"end":28,"cssClass":"pl-pds"},{"start":41,"end":42,"cssClass":"pl-pds"}],[{"start":8,"end":14,"cssClass":"pl-k"},{"start":15,"end":20,"cssClass":"pl-c1"}],[],[],[{"start":4,"end":12,"cssClass":"pl-c1"},{"start":22,"end":43,"cssClass":"pl-c1"},{"start":47,"end":50,"cssClass":"pl-c1"}],[{"start":4,"end":6,"cssClass":"pl-k"}],[{"start":8,"end":17,"cssClass":"pl-c1"},{"start":28,"end":69,"cssClass":"pl-s"},{"start":28,"end":29,"cssClass":"pl-pds"},{"start":68,"end":69,"cssClass":"pl-pds"}],[{"start":8,"end":14,"cssClass":"pl-k"},{"start":15,"end":20,"cssClass":"pl-c1"}],[],[],[{"start":4,"end":6,"cssClass":"pl-k"},{"start":9,"end":23,"cssClass":"pl-c1"}],[{"start":8,"end":16,"cssClass":"pl-c1"},{"start":27,"end":37,"cssClass":"pl-s"},{"start":27,"end":28,"cssClass":"pl-pds"},{"start":36,"end":37,"cssClass":"pl-pds"},{"start":51,"end":74,"cssClass":"pl-s"},{"start":51,"end":52,"cssClass":"pl-pds"},{"start":73,"end":74,"cssClass":"pl-pds"}],[{"start":8,"end":14,"cssClass":"pl-k"},{"start":15,"end":20,"cssClass":"pl-c1"}],[],[],[{"start":4,"end":6,"cssClass":"pl-c"},{"start":4,"end":6,"cssClass":"pl-c"}],[{"start":0,"end":75,"cssClass":"pl-c"}],[{"start":0,"end":79,"cssClass":"pl-c"}],[{"start":0,"end":56,"cssClass":"pl-c"}],[{"start":0,"end":6,"cssClass":"pl-c"}],[{"start":0,"end":70,"cssClass":"pl-c"}],[{"start":0,"end":79,"cssClass":"pl-c"}],[{"start":0,"end":73,"cssClass":"pl-c"}],[{"start":0,"end":74,"cssClass":"pl-c"}],[{"start":0,"end":15,"cssClass":"pl-c"}],[{"start":0,"end":7,"cssClass":"pl-c"},{"start":5,"end":7,"cssClass":"pl-c"}],[{"start":4,"end":7,"cssClass":"pl-k"},{"start":22,"end":41,"cssClass":"pl-c1"}],[{"start":4,"end":6,"cssClass":"pl-k"},{"start":17,"end":31,"cssClass":"pl-c1"}],[{"start":22,"end":41,"cssClass":"pl-c1"}],[],[],[{"start":28,"end":32,"cssClass":"pl-k"}],[{"start":4,"end":9,"cssClass":"pl-c1"},{"start":25,"end":26,"cssClass":"pl-c1"}],[{"start":4,"end":9,"cssClass":"pl-k"},{"start":10,"end":13,"cssClass":"pl-k"}],[],[{"start":4,"end":9,"cssClass":"pl-k"}],[{"start":16,"end":28,"cssClass":"pl-c1"},{"start":29,"end":39,"cssClass":"pl-c1"},{"start":89,"end":93,"cssClass":"pl-c1"}],[],[],[{"start":24,"end":40,"cssClass":"pl-c1"}],[{"start":23,"end":24,"cssClass":"pl-c1"}],[{"start":8,"end":10,"cssClass":"pl-k"}],[{"start":12,"end":17,"cssClass":"pl-k"}],[],[],[],[{"start":4,"end":8,"cssClass":"pl-k"},{"start":15,"end":19,"cssClass":"pl-c1"}],[{"start":4,"end":7,"cssClass":"pl-k"},{"start":9,"end":13,"cssClass":"pl-k"}],[{"start":16,"end":19,"cssClass":"pl-c1"}],[],[],[{"start":4,"end":6,"cssClass":"pl-k"}],[{"start":20,"end":24,"cssClass":"pl-c1"}],[{"start":8,"end":40,"cssClass":"pl-c1"}],[{"start":8,"end":16,"cssClass":"pl-c1"},{"start":26,"end":39,"cssClass":"pl-s"},{"start":26,"end":27,"cssClass":"pl-pds"},{"start":38,"end":39,"cssClass":"pl-pds"},{"start":61,"end":78,"cssClass":"pl-s"},{"start":61,"end":62,"cssClass":"pl-pds"},{"start":77,"end":78,"cssClass":"pl-pds"}],[{"start":26,"end":35,"cssClass":"pl-s"},{"start":26,"end":27,"cssClass":"pl-pds"},{"start":34,"end":35,"cssClass":"pl-pds"}],[{"start":26,"end":62,"cssClass":"pl-s"},{"start":26,"end":27,"cssClass":"pl-pds"},{"start":61,"end":62,"cssClass":"pl-pds"},{"start":72,"end":80,"cssClass":"pl-c1"},{"start":83,"end":88,"cssClass":"pl-c1"},{"start":94,"end":99,"cssClass":"pl-s"},{"start":94,"end":95,"cssClass":"pl-pds"},{"start":98,"end":99,"cssClass":"pl-pds"}],[{"start":8,"end":14,"cssClass":"pl-k"},{"start":15,"end":19,"cssClass":"pl-c1"}],[],[],[{"start":4,"end":10,"cssClass":"pl-k"},{"start":11,"end":16,"cssClass":"pl-c1"}],[],[],[{"start":3,"end":24,"cssClass":"pl-c"},{"start":3,"end":5,"cssClass":"pl-c"}],[{"start":3,"end":23,"cssClass":"pl-c"},{"start":3,"end":5,"cssClass":"pl-c"}]],"csv":null,"csvError":null,"dependabotInfo":{"showConfigurationBanner":false,"configFilePath":null,"networkDependabotPath":"/VoltageOS/system_core/network/updates","dismissConfigurationNoticePath":"/settings/dismiss-notice/dependabot_configuration_notice","configurationNoticeDismissed":null,"repoAlertsPath":"/VoltageOS/system_core/security/dependabot","repoSecurityAndAnalysisPath":"/VoltageOS/system_core/settings/security_analysis","repoOwnerIsOrg":true,"currentUserCanAdminRepo":false},"displayName":"snapuserd_verify.cpp","displayUrl":"https://github.com/VoltageOS/system_core/blob/13/fs_mgr/libsnapshot/snapuserd/user-space-merge/snapuserd_verify.cpp?raw=true","headerInfo":{"blobSize":"7.41 KB","deleteInfo":{"deleteTooltip":"You must be signed in to make or propose changes"},"editInfo":{"editTooltip":"You must be signed in to make or propose changes"},"ghDesktopPath":"https://desktop.github.com","gitLfsPath":null,"onBranch":true,"shortPath":"18c1dfc","siteNavLoginPath":"/login?return_to=https%3A%2F%2Fgithub.com%2FVoltageOS%2Fsystem_core%2Fblob%2F13%2Ffs_mgr%2Flibsnapshot%2Fsnapuserd%2Fuser-space-merge%2Fsnapuserd_verify.cpp","isCSV":false,"isRichtext":false,"toc":null,"lineInfo":{"truncatedLoc":"222","truncatedSloc":"183"},"mode":"file"},"image":false,"isCodeownersFile":null,"isPlain":false,"isValidLegacyIssueTemplate":false,"issueTemplateHelpUrl":"https://docs.github.com/articles/about-issue-and-pull-request-templates","issueTemplate":null,"discussionTemplate":null,"language":"C++","languageID":43,"large":false,"loggedIn":false,"newDiscussionPath":"/VoltageOS/system_core/discussions/new","newIssuePath":"/VoltageOS/system_core/issues/new","planSupportInfo":{"repoIsFork":null,"repoOwnedByCurrentUser":null,"requestFullPath":"/VoltageOS/system_core/blob/13/fs_mgr/libsnapshot/snapuserd/user-space-merge/snapuserd_verify.cpp","showFreeOrgGatedFeatureMessage":null,"showPlanSupportBanner":null,"upgradeDataAttributes":null,"upgradePath":null},"publishBannersInfo":{"dismissActionNoticePath":"/settings/dismiss-notice/publish_action_from_dockerfile","dismissStackNoticePath":"/settings/dismiss-notice/publish_stack_from_file","releasePath":"/VoltageOS/system_core/releases/new?marketplace=true","showPublishActionBanner":false,"showPublishStackBanner":false},"rawBlobUrl":"https://github.com/VoltageOS/system_core/raw/13/fs_mgr/libsnapshot/snapuserd/user-space-merge/snapuserd_verify.cpp","renderImageOrRaw":false,"richText":null,"renderedFileInfo":null,"shortPath":null,"tabSize":8,"topBannersInfo":{"overridingGlobalFundingFile":false,"globalPreferredFundingPath":null,"repoOwner":"VoltageOS","repoName":"system_core","showInvalidCitationWarning":false,"citationHelpUrl":"https://docs.github.com/en/github/creating-cloning-and-archiving-repositories/creating-a-repository-on-github/about-citation-files","showDependabotConfigurationBanner":false,"actionsOnboardingTip":null},"truncated":false,"viewable":true,"workflowRedirectUrl":null,"symbols":{"timed_out":false,"not_analyzed":false,"symbols":[{"name":"UpdateVerify","kind":"method","ident_start":904,"ident_end":916,"extent_start":890,"extent_end":1020,"fully_qualified_name":"UpdateVerify::UpdateVerify","ident_utf16":{"start":{"line_number":29,"utf16_col":14},"end":{"line_number":29,"utf16_col":26}},"extent_utf16":{"start":{"line_number":29,"utf16_col":0},"end":{"line_number":30,"utf16_col":73}}},{"name":"CheckPartitionVerification","kind":"method","ident_start":1041,"ident_end":1067,"extent_start":1022,"extent_end":1511,"fully_qualified_name":"UpdateVerify::CheckPartitionVerification","ident_utf16":{"start":{"line_number":32,"utf16_col":19},"end":{"line_number":32,"utf16_col":45}},"extent_utf16":{"start":{"line_number":32,"utf16_col":0},"end":{"line_number":46,"utf16_col":1}}},{"name":"UpdatePartitionVerificationState","kind":"method","ident_start":1532,"ident_end":1564,"extent_start":1513,"extent_end":1704,"fully_qualified_name":"UpdateVerify::UpdatePartitionVerificationState","ident_utf16":{"start":{"line_number":48,"utf16_col":19},"end":{"line_number":48,"utf16_col":51}},"extent_utf16":{"start":{"line_number":48,"utf16_col":0},"end":{"line_number":54,"utf16_col":1}}},{"name":"VerifyUpdatePartition","kind":"method","ident_start":1725,"ident_end":1746,"extent_start":1706,"extent_end":3025,"fully_qualified_name":"UpdateVerify::VerifyUpdatePartition","ident_utf16":{"start":{"line_number":56,"utf16_col":19},"end":{"line_number":56,"utf16_col":40}},"extent_utf16":{"start":{"line_number":56,"utf16_col":0},"end":{"line_number":92,"utf16_col":1}}},{"name":"VerifyBlocks","kind":"method","ident_start":3046,"ident_end":3058,"extent_start":3027,"extent_end":4780,"fully_qualified_name":"UpdateVerify::VerifyBlocks","ident_utf16":{"start":{"line_number":94,"utf16_col":19},"end":{"line_number":94,"utf16_col":31}},"extent_utf16":{"start":{"line_number":94,"utf16_col":0},"end":{"line_number":140,"utf16_col":1}}},{"name":"VerifyPartition","kind":"method","ident_start":4801,"ident_end":4816,"extent_start":4782,"extent_end":7536,"fully_qualified_name":"UpdateVerify::VerifyPartition","ident_utf16":{"start":{"line_number":142,"utf16_col":19},"end":{"line_number":142,"utf16_col":34}},"extent_utf16":{"start":{"line_number":142,"utf16_col":0},"end":{"line_number":218,"utf16_col":1}}}]}},"copilotInfo":null,"copilotAccessAllowed":false,"csrf_tokens":{"/VoltageOS/system_core/branches":{"post":"DrEA5jCGP-0vDuTQMOBarPBLRw-SDYbl0Ftw4HbxtaDEuGlvIPwptjWeDlJXzjOcnPuCvAyVr1waFaGV6lqz8w"},"/repos/preferences":{"post":"vPwAHsih5H9K5xfXSO09Z8RdjfgYRnn6CdQWNuvjpwc3yT3zG0K_Q7secVfmCWOQk6t5VTOSnDl5c6achwrnBA"}}},"title":"system_core/fs_mgr/libsnapshot/snapuserd/user-space-merge/snapuserd_verify.cpp at 13 Â· VoltageOS/system_core"}